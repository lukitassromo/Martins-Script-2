<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Martin's Cafe</title>
  <link rel="stylesheet" href="body.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="logo" onclick="document.getElementById('logoInput').click();">
      <img src="img/logo.png" alt="Logo" class="logo-img" id="logoPreview" />
      <img src="img/logotipo-puro.png" alt="Martin's Cafe" style="height: 32px;" />
      <input type="file" id="logoInput" accept="image/*" style="display: none" onchange="cambiarLogo(this)" />
    </div>
  </header>

  <section class="hero">
    <div class="hero-img" onclick="document.getElementById('portadaInput').click();"></div>
    <input type="file" id="portadaInput" accept="image/*" style="display:none" onchange="cambiarPortada(this)" />
    <div class="hero-text">
      <p>El mejor plan<br />está en <span class="highlight">Martin's</span></p>
    </div>
  </section>

  <!-- Sección de Promociones -->
  <section class="promociones">
    <h2>Promociones</h2>
    <p>Promociones del mes</p>
    <div class="promo-grid" id="promoContainer"></div>
    <button onclick="agregarItem('promo')">Agregar promoción</button>
  </section>

  <!-- Sección Para Comer -->
  <section class="menu1">
    <h2>Para comer</h2>
    <p>Disfrutá nuestros postres artesanales recién horneados</p>
    <div class="menu1-grid" id="comidaContainer"></div>
    <button onclick="agregarItem('comida')">Agregar ítem</button>
  </section>

  <!-- Sección Para Tomar -->
  <section class="menu2">
    <h2>Para tomar</h2>
    <p>Cafés, tés y bebidas especiales para cada momento</p>
    <div class="menu2-grid" id="bebidaContainer"></div>
    <button onclick="agregarItem('bebida')">Agregar ítem</button>
  </section>

  <footer>
    <p>Rondeau 1999, Córdoba, Argentina</p>
    <div class="socials">
      <img src="img/instagram.png" alt="Instagram" style="height: 24px; margin: 0 0.5rem;">
      <img src="img/mail.png" alt="Email" style="height: 24px; margin: 0 0.5rem;">
      <img src="img/whatsapp.png" alt="WhatsApp" style="height: 24px; margin: 0 0.5rem;">
    </div>
  </footer>

  <script>
  const defaultData = {
    promo: [
      { nombre: "2x1 en café", descripcion: "Dos cafés por el precio de uno los martes", precio: "", img: "" }
    ],
    comida: [
      { nombre: "Cheesecake", descripcion: "Porción individual", precio: "3.00", img: "" }
    ],
    bebida: [
      { nombre: "Café Latte", descripcion: "Café con leche", precio: "3.00", precioBase: 3.00, tamanio: "peque", img: "" }
    ]
  };

  let data = JSON.parse(localStorage.getItem("menuData")) || structuredClone(defaultData);

  // Asegurar consistencia de datos
  Object.keys(data).forEach(tipo =>
    data[tipo].forEach(item => {
      if (item.precio && !item.precioBase) {
        item.precioBase = parseFloat(item.precio);
      }
      if (!item.tamanio && tipo === "bebida") {
        item.tamanio = "peque";
      }
    })
  );

  function guardarData() {
    localStorage.setItem("menuData", JSON.stringify(data));
  }

  function renderItems(tipo) {
    const container = document.getElementById(`${tipo}Container`);
    container.innerHTML = "";

    data[tipo].forEach((item, index) => {
      const div = document.createElement("div");
      div.className = tipo === "promo" ? "promo-card" : "item";

      const inputFile = `<input type="file" style="display:none" accept="image/*" onchange="cambiarImagen(event, '${tipo}', ${index})">`;
      const imgDiv = `<div class="img" style="background-image:url('${item.img || "img/default.png"}')" onclick="this.previousElementSibling.click()"></div>`;

      let contenido = `${inputFile}${imgDiv}
        <p contenteditable="true" oninput="actualizarTexto('${tipo}', ${index}, 'nombre', this.innerText)">${item.nombre}</p>
        <p contenteditable="true" oninput="actualizarTexto('${tipo}', ${index}, 'descripcion', this.innerText)">${item.descripcion}</p>`;

      if (tipo !== "promo") {
        contenido += `
          <p class="precio" contenteditable="true" onblur="actualizarPrecio('${tipo}', ${index}, this.innerText)">$${item.precio}</p>`;

        if (tipo === "bebida") {
          contenido += `
            <select onchange="cambiarTamanio('${tipo}', ${index}, this.value)">
              <option value="peque" ${item.tamanio === "peque" ? "selected" : ""}>Pequeño</option>
              <option value="med" ${item.tamanio === "med" ? "selected" : ""}>Mediano</option>
              <option value="gran" ${item.tamanio === "gran" ? "selected" : ""}>Grande</option>
            </select>`;
        }
      }

      contenido += `<button onclick="eliminarItem('${tipo}', ${index})">Eliminar</button>`;
      div.innerHTML = contenido;
      container.appendChild(div);
    });
  }

  function actualizarTexto(tipo, index, campo, valor) {
    data[tipo][index][campo] = valor;
    guardarData();
  }

  function actualizarPrecio(tipo, index, valor) {
    const limpio = parseFloat(valor.replace(/[^0-9.]/g, '')) || 0;
    data[tipo][index].precioBase = limpio;

    if (tipo === "bebida") {
      const tamanio = data[tipo][index].tamanio || "peque";
      data[tipo][index].precio = calcularPrecioConTamanio(limpio, tamanio);
    } else {
      data[tipo][index].precio = limpio.toFixed(2);
    }

    guardarData();
    renderItems(tipo);
  }

  function cambiarTamanio(tipo, index, seleccion) {
    const item = data[tipo][index];
    item.tamanio = seleccion;
    item.precio = calcularPrecioConTamanio(item.precioBase || 0, seleccion);
    guardarData();
    renderItems(tipo);
  }

  function calcularPrecioConTamanio(base, tamanio) {
    if (tamanio === "med") return (base * 1.165).toFixed(2);
    if (tamanio === "gran") return (base * 1.33).toFixed(2);
    return base.toFixed(2); // peque
  }

  function cambiarImagen(event, tipo, index) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
      data[tipo][index].img = e.target.result;
      guardarData();
      renderItems(tipo);
    };
    reader.readAsDataURL(file);
  }

  function eliminarItem(tipo, index) {
    data[tipo].splice(index, 1);
    guardarData();
    renderItems(tipo);
  }

  function agregarItem(tipo) {
    const nuevo = {
      nombre: "Nuevo ítem",
      descripcion: "Descripción aquí",
      precio: tipo === "promo" ? "" : "0.00",
      precioBase: tipo === "promo" ? undefined : 0.00,
      img: ""
    };

    if (tipo === "bebida") {
      nuevo.tamanio = "peque";
    }

    data[tipo].push(nuevo);
    guardarData();
    renderItems(tipo);
  }

  function cambiarPortada(input) {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
      document.querySelector(".hero-img").style.backgroundImage = `url('${e.target.result}')`;
    };
    reader.readAsDataURL(file);
  }

  function cambiarLogo(input) {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById("logoPreview").src = e.target.result;
    };
    reader.readAsDataURL(file);
  }

  ["promo", "comida", "bebida"].forEach(renderItems);
</script>
